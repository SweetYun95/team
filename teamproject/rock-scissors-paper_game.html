<!DOCTYPE html>
<html lang="ko">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Document</title>
      <link rel="stylesheet" href="./css/common.css" />
      <link rel="stylesheet" href="./css/main.css" />
   </head>
   <body>
      <main>
         <!-- ê²Œì„ ì‹œì‘ í™”ë©´ -->
         <section class="game2__start">
            <div class="game-rule">
               <div class="rule__caption">
                  <h2>ê°€ìœ„ë°”ìœ„ë³´ ê²Œì„ ê·œì¹™</h2>
                  <p>
                     ê°€ìœ„âœŒï¸, ë°”ìœ„âœŠ, ë³´ğŸ–ï¸ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.<br />
                     ì»´í“¨í„°ì™€ ëŒ€ê²°í•˜ì—¬ ì´ê¸°ë©´ ì ìˆ˜ë¥¼ íšë“í•©ë‹ˆë‹¤.<br />
                     (ìŠ¹ë¦¬ì‹œ +50, ë¬´ìŠ¹ë¶€ì‹œ +10)
                  </p>
               </div>
               <div class="rule-select">
                  <label for="round-select">ë¼ìš´ë“œ ìˆ˜ ì„ íƒ:</label>
                  <select name="round-select" id="round-select">
                     <option value="">íŒ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                     <option value="10">10íŒ</option>
                     <option value="20">20íŒ</option>
                     <option value="30">30íŒ</option>
                  </select>
               </div>
               <div class="start-bnt">
                  <div class="gohome-btn">
                     <button onclick="location.href='index.html'">í™ˆìœ¼ë¡œ</button>
                  </div>
                  <div class="letgo-btn">
                     <button id="start-game-btn">ê²Œì„ ì‹œì‘</button>
                  </div>
               </div>
            </div>
         </section>

         <!-- ê²Œì„ ë©”ì¸ í™”ë©´ -->
         <section class="game2" style="display: none">
            <div class="game2__rock-scissors-paper">
               <div class="game2__round">
                  <p><span id="current-round">1</span> / <span id="total-round">10</span> íŒ</p>
               </div>
               <div class="rock-scissors-paper__VS">
                  <div class="user">ğŸ‘¤</div>
                  <div class="com_zone">ğŸ’»</div>
               </div>
               <div class="btn">
                  <button class="scissors">ê°€ìœ„ âœŒï¸</button>
                  <button class="rock">ë°”ìœ„ âœŠ</button>
                  <button class="paper">ë³´ ğŸ–ï¸</button>
               </div>
               <div class="game-result"></div>
            </div>
         </section>

         <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ -->
         <section class="game2__end" style="display: none">
            <div class="game-finish">
               <div class="game-record">
                  <p>ìŠ¹: <span id="win-count">0</span></p>
                  <p>ë¬´: <span id="draw-count">0</span></p>
                  <p>íŒ¨: <span id="lose-count">0</span></p>
               </div>
               <div class="game-score">
                  <p>ìµœì¢… ì ìˆ˜: <span id="final-score">0</span>ì </p>
               </div>
               <div class="reroll-btn">
                  <div class="re">
                     <button id="retry-btn">ë‹¤ì‹œí•˜ê¸°</button>
                  </div>
                  <div class="gomain">
                     <button id="to-start-btn">ì²˜ìŒìœ¼ë¡œ</button>
                  </div>
                  <div class="gohome-btn">
                     <button onclick="location.href='index.html'">í™ˆìœ¼ë¡œ</button>
                  </div>
               </div>
            </div>
         </section>
      </main>

      <!-- JaveScript -->
      <script>
         const options = ['ê°€ìœ„', 'ë°”ìœ„', 'ë³´']
         const buttons = document.querySelectorAll('.btn button')
         const resultDiv = document.querySelector('.game-result')
         const userDiv = document.querySelector('.user')
         const comDiv = document.querySelector('.com_zone')
         const roundSelect = document.getElementById('round-select')
         const startBtn = document.querySelector('.letgo-btn')
         const gameStartSection = document.querySelector('.game2__start')
         const gameMainSection = document.querySelector('.game2')
         const gameEndSection = document.querySelector('.game2__end')
         const roundDisplay = document.querySelector('.game2__round')
         const gameRecord = document.querySelector('.game-record')
         const gameScore = document.querySelector('.game-score')
         const restartBtn = document.querySelector('.re')

         let totalRounds = 0
         let currentRound = 1
         let win = 0
         let draw = 0
         let lose = 0

         // ì‹œì‘ ë²„íŠ¼ í´ë¦­
         startBtn.addEventListener('click', () => {
            const selected = roundSelect.value

            if (!selected || isNaN(selected)) {
               alert('íŒ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”!')
               return
            }

            totalRounds = parseInt(selected)
            gameStartSection.style.display = 'none'
            gameMainSection.style.display = 'block'
            updateRoundDisplay()
         })

         function updateRoundDisplay() {
            roundDisplay.textContent = `${currentRound} / ${totalRounds} íŒ`
         }

         function getResult(user, com) {
            if (user === com) {
               draw++
               return 'ë¬´ìŠ¹ë¶€!'
            }
            if ((user === 'ê°€ìœ„' && com === 'ë³´') || (user === 'ë°”ìœ„' && com === 'ê°€ìœ„') || (user === 'ë³´' && com === 'ë°”ìœ„')) {
               win++
               return 'ìŠ¹ë¦¬!'
            } else {
               lose++
               return 'íŒ¨ë°°!'
            }
         }

         buttons.forEach((button) => {
            button.addEventListener('click', () => {
               if (currentRound > totalRounds) return

               const userChoice = button.className
               const userText = userChoice === 'scissors' ? 'ê°€ìœ„' : userChoice === 'rock' ? 'ë°”ìœ„' : 'ë³´'

               const comText = options[Math.floor(Math.random() * 3)]

               userDiv.textContent = `ğŸ‘¤ ${userText}`
               comDiv.textContent = `${comText} ğŸ’»`
               resultDiv.textContent = getResult(userText, comText)

               if (currentRound === totalRounds) {
                  setTimeout(showEndScreen, 1000)
               } else {
                  currentRound++
                  updateRoundDisplay()
               }
            })
         })

         function showEndScreen() {
            gameMainSection.style.display = 'none'
            gameEndSection.style.display = 'block'

            gameRecord.innerHTML = `
            <p>ìŠ¹: ${win}íšŒ</p>
            <p>ë¬´: ${draw}íšŒ</p>
            <p>íŒ¨: ${lose}íšŒ</p>
          `

            const score = win * 50 + draw * 10
            gameScore.innerHTML = `<p>ì´ ì ìˆ˜: ${score}ì </p>`
         }

         // ë‹¤ì‹œ ì‹œì‘ ë²„íŠ¼ (ì„ íƒì ìœ¼ë¡œ ì—°ê²°)
         if (restartBtn) {
            restartBtn.addEventListener('click', () => {
               currentRound = 1
               win = draw = lose = 0
               resultDiv.textContent = ''
               gameEndSection.style.display = 'none'
               gameMainSection.style.display = 'block'
               updateRoundDisplay()
            })
         }

         // "ì²˜ìŒìœ¼ë¡œ" ë²„íŠ¼ í´ë¦­ ì‹œ - ì‹œì‘í™”ë©´ìœ¼ë¡œ ë³µê·€
         const toStartBtn = document.getElementById('to-start-btn')

         toStartBtn.addEventListener('click', () => {
            // ëª¨ë“  ê²Œì„ ê´€ë ¨ ìƒíƒœ ì´ˆê¸°í™”
            currentRound = 1
            win = draw = lose = 0
            resultDiv.textContent = ''
            userDiv.textContent = 'ğŸ‘¤'
            comDiv.textContent = 'ğŸ’»'
            roundSelect.value = ''

            // í™”ë©´ ì „í™˜
            gameEndSection.style.display = 'none'
            gameStartSection.style.display = 'block'
         })
      </script>
   </body>
</html>
